# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TypeScript, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с компонентами
- src/components/base/ — базовые компоненты (EventEmitter, Component, Modal, Api)
- src/components/common/ — компоненты приложения (Card, Basket, Order, Catalog и др.)
- src/scss/ — стили проекта
- src/types/ — типы TypeScript
- src/utils/ — утилиты и константы
- src/pages/ — HTML-шаблоны страниц

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура проекта

Архитектура приложения реализована по паттерну MVP (Model-View-Presenter):

- **Модель** (Model) предоставляет данные для пользовательского интерфейса. Отвечает за хранение и обработку данных, обновление состояния приложения.
- **Представление** (View) реализует отображение данных и маршрутизацию пользовательских команд или событий Presenter'у. Отвечает за визуальное представление данных и взаимодействие с пользователем.
- **Presenter** управляет Моделью и Представлением, связывая их. Содержит бизнес-логику приложения, обрабатывает события пользовательского интерфейса и обновляет Модель и Представление.

Для передачи событий между компонентами используется брокер событий (EventEmitter), что позволяет реализовать слабое связывание компонентов системы и обеспечить гибкость архитектуры.

## Базовые классы

### 1. Класс EventEmitter
Реализует паттерн «Наблюдатель». Брокер событий, позволяющий компонентам подписываться на события и получать уведомления при их возникновении.

Основные методы:
- `on(event, callback)` - подписка на событие. Регистрирует обработчик для указанного события.
- `off(event, callback)` - отмена подписки. Удаляет зарегистрированный обработчик события.
- `emit(event, data)` - генерация события с данными. Вызывает все обработчики, зарегистрированные для указанного события, передавая им данные.
- `trigger(event, context)` - создание обработчика-триггера. Возвращает функцию, которая при вызове генерирует указанное событие с данными.
- `onAll(callback)` - подписка на все события. Регистрирует обработчик, который будет вызываться при любом событии.
- `offAll()` - сброс всех подписок. Удаляет все зарегистрированные обработчики событий.

### 2. Класс Api
Обеспечивает взаимодействие с сервером по HTTP. Абстрагирует работу с API сервера, инкапсулируя логику запросов и обработки ответов.

Основные методы:
- `get(uri)` - выполняет GET-запрос по указанному URI. Возвращает Promise с данными ответа.
- `post(uri, data, method)` - выполняет POST/PUT/DELETE запросы по указанному URI с переданными данными. Метод запроса можно указать в параметре method. Возвращает Promise с данными ответа.
- `handleResponse()` - внутренний обработчик ответов. Проверяет статус ответа и преобразует его в JSON или выбрасывает ошибку.

### 3. Класс Component
Базовый класс для всех компонентов пользовательского интерфейса. Предоставляет общие методы для работы с DOM и управления состоянием компонента.

Методы класса:
- `toggleClass(element, className, force)` - переключает CSS-класс элемента. Добавляет или удаляет указанный класс в зависимости от параметра force.
- `setText(element, value)` - устанавливает текстовое содержимое элемента. Преобразует переданное значение в строку.
- `setDisabled(element, state)` - управляет блокировкой элемента. Устанавливает или снимает атрибут 'disabled' в зависимости от параметра state.
- `setImage(element, src, alt)` - устанавливает изображение с альт-текстом. Обновляет атрибуты 'src' и 'alt' для элемента img.
- `render(data)` - рендерит компонент и возвращает DOM-элемент. Метод может быть переопределен в дочерних классах для реализации специфической логики отрисовки.

## Компоненты приложения

### 1. WebLarekAPIModel
Модель для взаимодействия с API сервера. Наследуется от Api. Реализует специфичные для приложения методы работы с API.

Методы класса:
- `getCatalog()` - получает каталог товаров с сервера. Выполняет GET-запрос к соответствующему эндпоинту API и возвращает список товаров.
- `createOrder(order)` - отправляет данные заказа на сервер. Выполняет POST-запрос с данными заказа и возвращает результат обработки заказа.

### 2. Page
Класс для управления главной страницей приложения. Отвечает за отображение каталога товаров, счетчика корзины и управление состоянием страницы.

Методы класса:
- `counter(count)` - обновляет счетчик товаров в корзине. Отображает количество товаров рядом с иконкой корзины.
- `catalog(items)` - рендерит каталог товаров на странице. Принимает массив HTML-элементов карточек товаров и добавляет их в секцию каталога.
- `locked(isLocked)` - блокирует/разблокирует прокрутку страницы. Используется при открытии модальных окон для предотвращения прокрутки основной страницы.

### 3. Card и его производные (StoreItem, StoreItemPreview)
Классы для отображения карточек товаров в каталоге и предпросмотре. Базовый класс Card содержит общую логику, а производные классы расширяют его функциональность.

Методы базового класса Card:
- `title(value)` - устанавливает название товара. Обновляет соответствующий элемент в DOM.
- `image(src)` - устанавливает изображение товара. Обновляет атрибут src изображения.
- `description(text)` - устанавливает описание товара. Обновляет соответствующий элемент в DOM.
- `category(value)` - устанавливает категорию товара. Применяет соответствующий CSS-класс в зависимости от категории.
- `price(amount)` - устанавливает цену товара. Форматирует цену и обновляет соответствующий элемент в DOM.

Методы класса StoreItem (дополнительно к базовым):
- `buttonTitle(title)` - устанавливает текст на кнопке карточки товара.
- `renderPrice(price)` - специальный метод для отображения цены, учитывающий возможные нулевые значения.

Методы класса StoreItemPreview (дополнительно к базовым):
- `text(content)` - устанавливает подробное описание товара для предпросмотра.
- `button(state)` - управляет состоянием кнопки добавления в корзину.

### 4. Basket
Класс для управления корзиной товаров. Отвечает за отображение товаров в корзине, подсчет общей стоимости и управление товарами.

Методы класса:
- `items(elements)` - отображает товары в корзине. Принимает массив HTML-элементов товаров и добавляет их в контейнер корзины.
- `total(amount)` - обновляет общую стоимость заказа. Форматирует сумму и отображает ее в соответствующем элементе.
- `addProduct(product)` - добавляет товар в корзину. Создает новый элемент товара и добавляет его в список.
- `removeProduct(id)` - удаляет товар из корзины по идентификатору. Находит соответствующий элемент и удаляет его.
- `clearBasket()` - очищает корзину. Удаляет все товары из корзины и сбрасывает общую стоимость.
- `getTotal()` - рассчитывает общую стоимость товаров в корзине.
- `getProducts()` - возвращает массив товаров в корзине.
- `disableButton()` - управляет состоянием кнопки оформления заказа в зависимости от наличия товаров в корзине.
- `updateView()` - обновляет отображение корзины после изменений.

### 5. Order
Класс для управления формой заказа. Обрабатывает ввод данных для доставки и проверяет их корректность.

Методы класса:
- `payment(name)` - управляет выбором способа оплаты. Переключает активный класс для соответствующей кнопки выбора оплаты.
- `address(value)` - устанавливает адрес доставки. Обновляет значение поля ввода адреса.
- `validateOrder()` - проверяет корректность данных заказа. Проверяет наличие обязательных полей и их соответствие требуемому формату.
- `setErrorMessage(field, message)` - устанавливает сообщение об ошибке для указанного поля.
- `clearErrorMessages()` - очищает все сообщения об ошибках в форме.
- `submit()` - обрабатывает отправку формы заказа. Выполняет валидацию и генерирует соответствующее событие.

### 6. Modal
Класс для управления модальными окнами. Обеспечивает отображение и скрытие модальных окон с различным содержимым.

Методы класса:
- `content(element)` - устанавливает содержимое окна. Принимает HTML-элемент и добавляет его в контейнер модального окна.
- `open()` - открывает модальное окно. Добавляет активный класс для отображения окна и генерирует событие открытия.
- `close()` - закрывает модальное окно. Удаляет активный класс, очищает содержимое и генерирует событие закрытия.
- `render(data)` - рендерит модальное окно с указанными данными. Устанавливает содержимое и открывает окно.
- `setContent(element)` - внутренний метод для установки содержимого в контейнер модального окна.
- `subscribe(eventName, callback)` - подписывается на события модального окна (открытие/закрытие).

## Типы данных

- `IProduct` - интерфейс товара. Описывает структуру данных товара с полями id, description, image, title, category, price.
- `IBasket` - интерфейс корзины. Определяет методы для работы с корзиной товаров.
- `IOrder` - интерфейс заказа. Описывает структуру данных заказа с полями id, total, email, phone, address, items, payment.
- `TPaymentType` - тип способа оплаты. Может принимать значения 'online' (онлайн-оплата) или 'paymentOnDelivery' (оплата при доставке).
- `CategoryType` - тип категории товара. Может принимать значения 'софт-скил', 'хард-скил', 'дополнительное', 'другое'.
- `IOrderDto` - интерфейс DTO (Data Transfer Object) заказа для передачи на сервер. Отличается от IOrder тем, что items содержит только идентификаторы товаров.

## Утилиты

### Utils
Файл с вспомогательными функциями, используемыми в различных частях приложения.

Основные функции:
- `ensureElement(selector)` - находит элемент в DOM по селектору и возвращает его. Выбрасывает ошибку, если элемент не найден.
- `cloneTemplate(template)` - клонирует шаблон и возвращает его содержимое. Используется для создания элементов из шаблонов.
- `formatPrice(price)` - форматирует цену, добавляя знак валюты и разделители тысяч.
- `handlePrice(price)` - обрабатывает цену, возвращая форматированную строку или 'Бесценно' для нулевых значений.
- `isEmpty(value)` - проверяет, является ли значение пустым (null, undefined, пустая строка).
- `isValidEmail(email)` - проверяет корректность формата email.
- `isValidPhone(phone)` - проверяет корректность формата телефонного номера.